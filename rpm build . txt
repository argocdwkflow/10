Parfait ğŸ‘
LÃ  on a le diagnostic complet :
ğŸ‘‰ RPMDB corrompue + clÃ©s GPG absentes / incohÃ©rentes
ğŸ‘‰ dâ€™oÃ¹ rpmdbNextIterator ET Ã©chec de signature RPM
Je vais te donner LA procÃ©dure N3 qui marche en prod, adaptÃ©e exactement Ã  ce que tu montres Ã  lâ€™Ã©cran.
ğŸ” Ce que montre ta capture (analyse)
Dans /var/lib/rpm on voit :
âœ”ï¸ Packages, Basenames, Dirnames, etc. recrÃ©Ã©s
âœ”ï¸ plusieurs tentatives de rebuild
âŒ PAS de rÃ©pertoire Pubkeys
âŒ donc aucune clÃ© GPG importÃ©e
âŒ RPM ne peut plus valider les signatures
âŒ yum â†’ rpmdbNextIterator / failed release provides
ğŸ‘‰ La base est partiellement reconstruite mais sans clÃ©s â†’ inutilisable
âœ… SOLUTION COMPLÃˆTE (ordre strict)
ğŸŸ¥ 1ï¸âƒ£ ArrÃªt + sauvegarde (derniÃ¨re fois)
Copy code
Bash
ps -ef | egrep 'yum|rpm' | grep -v grep
cd /var/lib
cp -a rpm rpm.SIGNATURE_FIX.$(date +%F_%H%M)
ğŸŸ¥ 2ï¸âƒ£ Nettoyage propre de la base RPM (clÃ© du succÃ¨s)
âš ï¸ On repart vraiment clean
Copy code
Bash
cd /var/lib/rpm
rm -f __db*
rm -f Packages
rm -f Name* Basenames* Dirnames* Require* Provide* Sigmd5* Trigger* Installtid*
Puis :
Copy code
Bash
rpm --initdb
ğŸ‘‰ Ã€ ce stade : rpmdb vide mais saine
ğŸŸ¥ 3ï¸âƒ£ RecrÃ©er le rÃ©pertoire Pubkeys (il manque chez toi)
Copy code
Bash
mkdir -p /var/lib/rpm/pubkeys
chmod 755 /var/lib/rpm/pubkeys
âš ï¸ Sur RHEL 7, les clÃ©s sont dans la rpmdb, pas juste des fichiers
ğŸŸ¥ 4ï¸âƒ£ RÃ©importer les clÃ©s GPG RHEL 7 (OBLIGATOIRE)
Copy code
Bash
rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
VÃ©rifie :
Copy code
Bash
rpm -qa gpg-pubkey*
ğŸ‘‰ Si vide = problÃ¨me dâ€™OS (dis-le moi)
ğŸŸ¥ 5ï¸âƒ£ RÃ©installer redhat-release (CAUSE PRINCIPALE)
Copy code
Bash
rpm -qa | grep redhat-release
Si absent ou cassÃ© :
Copy code
Bash
yum reinstall redhat-release redhat-release-server -y
Si yum ne passe pas encore ğŸ‘‰ ISO obligatoire :
Copy code
Bash
mount /dev/cdrom /mnt
rpm -Uvh --replacepkgs /mnt/Packages/redhat-release*.rpm
ğŸŸ¥ 6ï¸âƒ£ Reconstruction finale RPMDB
Copy code
Bash
rm -f /var/lib/rpm/__db*
rpm --rebuilddb -vv
â³ Laisse finir (pas de Ctrl+C)
ğŸŸ¥ 7ï¸âƒ£ Validation finale (doit passer)
Copy code
Bash
rpm -qa | wc -l
yum clean all
yum repolist
yum check
âœ”ï¸ Plus dâ€™erreur rpmdbNextIterator
âœ”ï¸ Plus dâ€™erreur de signature
ğŸš¨ Si la signature Ã©choue encore
Contournement temporaire (urgence prod)
Copy code
Bash
echo "gpgcheck=0" >> /etc/yum.conf
âš ï¸ TEMPORAIRE UNIQUEMENT
Ã€ enlever aprÃ¨s rÃ©paration dÃ©finitive.
ğŸ§  Pourquoi ton cas est spÃ©cial
Snapshot / crash ancien (2022â€“2023 visible)
Multiples rebuilds partiels
rpmdb reconstruite sans les clÃ©s
Yum dÃ©pend fortement de redhat-release provides
âœ… Conclusion N3 claire
âœ”ï¸ Le problÃ¨me nâ€™est plus le rebuild
âœ”ï¸ Le problÃ¨me = clÃ© GPG + redhat-release absents de la rpmdb
âœ”ï¸ La solution = reset propre + import clÃ©s + reinstall release
Dis-moi maintenant :
1ï¸âƒ£ Serveur Satellite / Capsule / Standalone
2ï¸âƒ£ AccÃ¨s ISO RHEL 7 oui/non
3ï¸âƒ£ Version exacte (7.6, 7.9â€¦)
Je tâ€™adapte la commande finale exacte Ã  ton environnement (prod-safe).