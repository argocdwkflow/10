Voici la procÃ©dure claire et correcte (niveau production / Satellite 6.17â€“6.18) pour mettre en place des certificats SSL/TLS sur Red Hat Satellite Web UI (HTTPS) et sur les Capsules, avec les bonnes pratiques Red Hat ğŸ”
ğŸ¯ Objectif
AccÃ¨s HTTPS sÃ©curisÃ© au Satellite Web UI
Communication SSL valide Satellite â‡„ Capsules â‡„ Clients
Ã‰viter les certificats auto-signÃ©s non reconnus
ConformitÃ© sÃ©curitÃ© (banque / prod / audit)
ğŸ§± Architecture SSL Red Hat Satellite (rappel)
Satellite = CA interne (par dÃ©faut)
Capsules = certificats signÃ©s par la CA Satellite
Clients = certificats hÃ´te + CA Satellite
Web UI = certificat serveur HTTPS
ğŸŸ¢ MÃ‰THODE RECOMMANDÃ‰E (Red Hat Best Practice)
ğŸ‘‰ Garder la CA interne Satellite ğŸ‘‰ Remplacer UNIQUEMENT le certificat HTTPS du Web UI ğŸ‘‰ Capsules restent signÃ©es par Satellite (plus simple & supportÃ©)
1ï¸âƒ£ VÃ©rifier le FQDN du Satellite (CRITIQUE)
Copy code
Bash
hostname -f
Exemple attendu :
Copy code

satellite-prod.example.com
âš ï¸ Le CN/SAN du certificat doit matcher exactement ce FQDN
2ï¸âƒ£ GÃ©nÃ©rer une CSR (Certificate Signing Request)
ğŸ“ RÃ©pertoire recommandÃ©
Copy code
Bash
mkdir -p /root/ssl
cd /root/ssl
âœï¸ CrÃ©er la CSR
Copy code
Bash
openssl req -new -newkey rsa:4096 -nodes \
-keyout satellite.key \
-out satellite.csr
Renseigner :
Copy code

Common Name (CN) = satellite-prod.example.com
Organization = YourCompany
Country = FR
ğŸ‘‰ Ajoutez SAN (OBLIGATOIRE avec navigateurs modernes) :
Copy code
Bash
openssl req -new -newkey rsa:4096 -nodes \
-keyout satellite.key \
-out satellite.csr \
-subj "/CN=satellite-prod.example.com" \
-addext "subjectAltName=DNS:satellite-prod.example.com"
3ï¸âƒ£ Faire signer la CSR par une AutoritÃ© de Confiance
Options valides :
âœ… PKI interne entreprise (recommandÃ©)
âœ… DigiCert / GlobalSign / Sectigo
âš ï¸ Let's Encrypt â†’ OK seulement si Internet autorisÃ©
âš ï¸ Ne PAS utiliser auto-signÃ© en prod
Vous recevez :
satellite.crt
intermediate.crt
rootCA.crt
4ï¸âƒ£ Installer le certificat HTTPS sur Satellite
ğŸ“ Copier les fichiers
Copy code
Bash
cp satellite.key /etc/pki/tls/private/
cp satellite.crt /etc/pki/tls/certs/
cp intermediate.crt /etc/pki/tls/certs/
ğŸ”— CrÃ©er la chaÃ®ne complÃ¨te
Copy code
Bash
cat satellite.crt intermediate.crt > /etc/pki/tls/certs/satellite-fullchain.crt
5ï¸âƒ£ Appliquer le certificat avec satellite-installer
Copy code
Bash
satellite-installer \
--foreman-server-ssl-cert /etc/pki/tls/certs/satellite-fullchain.crt \
--foreman-server-ssl-key /etc/pki/tls/private/satellite.key \
--foreman-server-ssl-ca /etc/pki/tls/certs/rootCA.crt
â±ï¸ DurÃ©e : 5â€“10 minutes
6ï¸âƒ£ VÃ©rification HTTPS Web UI
Copy code
Bash
curl -vk https://satellite-prod.example.com
Navigateur :
ğŸ”’ cadenas vert
Pas dâ€™erreur CN/SAN
ğŸ”µ CERTIFICATS SSL POUR LES CAPSULES
ğŸ‘‰ RÃˆGLE Dâ€™OR
NE PAS utiliser une CA externe pour les Capsules
â¡ï¸ Capsules doivent Ãªtre signÃ©es par la CA Satellite
7ï¸âƒ£ GÃ©nÃ©rer le certificat Capsule depuis Satellite
Sur le Satellite :
Copy code
Bash
capsule-certs-generate \
--capsule-fqdn capsule-prod.example.com \
--certs-tar /root/capsule-prod-certs.tar
8ï¸âƒ£ Installer les certificats sur la Capsule
Copier lâ€™archive :
Copy code
Bash
scp /root/capsule-prod-certs.tar root@capsule-prod:/root/
Sur la Capsule :
Copy code
Bash
tar xvf capsule-prod-certs.tar
Puis :
Copy code
Bash
satellite-installer \
--scenario capsule \
--certs-tar-file capsule-prod-certs.tar \
--foreman-proxy-register-in-foreman true \
--foreman-proxy-foreman-base-url https://satellite-prod.example.com
9ï¸âƒ£ VÃ©rifier la Capsule
Copy code
Bash
hammer capsule list
hammer capsule info --name capsule-prod.example.com
Statut attendu :
Copy code

Status: OK
Certificates: valid
ğŸ” Ports HTTPS obligatoires (sÃ©curitÃ©)
Flux
Port
Satellite Web UI
443
Capsule â‡„ Satellite
443
Clients â‡„ Capsule
443
Pulp
24816
ğŸŸ¡ Erreurs frÃ©quentes (Ã  Ã©viter)
âŒ Certificat sans SAN
âŒ CN â‰  hostname
âŒ Certificat Capsule signÃ© par CA externe
âŒ Modification manuelle Apache sans satellite-installer
âŒ Firewall bloquant 443 inter-sites
âœ… RÃ©sumÃ© Architecture SSL PRO
Composant
Certificat
Satellite Web UI
CA entreprise
Capsules
CA Satellite
Clients RHEL
CA Satellite
Support Red Hat
100% OK
ğŸ‘‰ Si tu veux
Je peux te fournir :
âœ”ï¸ Checklist sÃ©curitÃ© audit (banque / ISO / CIS)
âœ”ï¸ Script automatisÃ© Ansible SSL Satellite + Capsules
âœ”ï¸ ProcÃ©dure spÃ©ciale environnement DISCONNECTED
âœ”ï¸ Migration SSL sans downtime
Dis-moi ton type dâ€™environnement (Prod / Qualif / Disconnected / Internet) et je tâ€™adapte la procÃ©dure ğŸ‘Œ


Voici la procÃ©dure claire et correcte (niveau production / Satellite 6.17â€“6.18) pour mettre en place des certificats SSL/TLS sur Red Hat Satellite Web UI (HTTPS) et sur les Capsules, avec les bonnes pratiques Red Hat ğŸ”
ğŸ¯ Objectif
AccÃ¨s HTTPS sÃ©curisÃ© au Satellite Web UI
Communication SSL valide Satellite â‡„ Capsules â‡„ Clients
Ã‰viter les certificats auto-signÃ©s non reconnus
ConformitÃ© sÃ©curitÃ© (banque / prod / audit)
ğŸ§± Architecture SSL Red Hat Satellite (rappel)
Satellite = CA interne (par dÃ©faut)
Capsules = certificats signÃ©s par la CA Satellite
Clients = certificats hÃ´te + CA Satellite
Web UI = certificat serveur HTTPS
ğŸŸ¢ MÃ‰THODE RECOMMANDÃ‰E (Red Hat Best Practice)
ğŸ‘‰ Garder la CA interne Satellite ğŸ‘‰ Remplacer UNIQUEMENT le certificat HTTPS du Web UI ğŸ‘‰ Capsules restent signÃ©es par Satellite (plus simple & supportÃ©)
1ï¸âƒ£ VÃ©rifier le FQDN du Satellite (CRITIQUE)
Copy code
Bash
hostname -f
Exemple attendu :
Copy code

satellite-prod.example.com
âš ï¸ Le CN/SAN du certificat doit matcher exactement ce FQDN
2ï¸âƒ£ GÃ©nÃ©rer une CSR (Certificate Signing Request)
ğŸ“ RÃ©pertoire recommandÃ©
Copy code
Bash
mkdir -p /root/ssl
cd /root/ssl
âœï¸ CrÃ©er la CSR
Copy code
Bash
openssl req -new -newkey rsa:4096 -nodes \
-keyout satellite.key \
-out satellite.csr
Renseigner :
Copy code

Common Name (CN) = satellite-prod.example.com
Organization = YourCompany
Country = FR
ğŸ‘‰ Ajoutez SAN (OBLIGATOIRE avec navigateurs modernes) :
Copy code
Bash
openssl req -new -newkey rsa:4096 -nodes \
-keyout satellite.key \
-out satellite.csr \
-subj "/CN=satellite-prod.example.com" \
-addext "subjectAltName=DNS:satellite-prod.example.com"
3ï¸âƒ£ Faire signer la CSR par une AutoritÃ© de Confiance
Options valides :
âœ… PKI interne entreprise (recommandÃ©)
âœ… DigiCert / GlobalSign / Sectigo
âš ï¸ Let's Encrypt â†’ OK seulement si Internet autorisÃ©
âš ï¸ Ne PAS utiliser auto-signÃ© en prod
Vous recevez :
satellite.crt
intermediate.crt
rootCA.crt
4ï¸âƒ£ Installer le certificat HTTPS sur Satellite
ğŸ“ Copier les fichiers
Copy code
Bash
cp satellite.key /etc/pki/tls/private/
cp satellite.crt /etc/pki/tls/certs/
cp intermediate.crt /etc/pki/tls/certs/
ğŸ”— CrÃ©er la chaÃ®ne complÃ¨te
Copy code
Bash
cat satellite.crt intermediate.crt > /etc/pki/tls/certs/satellite-fullchain.crt
5ï¸âƒ£ Appliquer le certificat avec satellite-installer
Copy code
Bash
satellite-installer \
--foreman-server-ssl-cert /etc/pki/tls/certs/satellite-fullchain.crt \
--foreman-server-ssl-key /etc/pki/tls/private/satellite.key \
--foreman-server-ssl-ca /etc/pki/tls/certs/rootCA.crt
â±ï¸ DurÃ©e : 5â€“10 minutes
6ï¸âƒ£ VÃ©rification HTTPS Web UI
Copy code
Bash
curl -vk https://satellite-prod.example.com
Navigateur :
ğŸ”’ cadenas vert
Pas dâ€™erreur CN/SAN
ğŸ”µ CERTIFICATS SSL POUR LES CAPSULES
ğŸ‘‰ RÃˆGLE Dâ€™OR
NE PAS utiliser une CA externe pour les Capsules
â¡ï¸ Capsules doivent Ãªtre signÃ©es par la CA Satellite
7ï¸âƒ£ GÃ©nÃ©rer le certificat Capsule depuis Satellite
Sur le Satellite :
Copy code
Bash
capsule-certs-generate \
--capsule-fqdn capsule-prod.example.com \
--certs-tar /root/capsule-prod-certs.tar
8ï¸âƒ£ Installer les certificats sur la Capsule
Copier lâ€™archive :
Copy code
Bash
scp /root/capsule-prod-certs.tar root@capsule-prod:/root/
Sur la Capsule :
Copy code
Bash
tar xvf capsule-prod-certs.tar
Puis :
Copy code
Bash
satellite-installer \
--scenario capsule \
--certs-tar-file capsule-prod-certs.tar \
--foreman-proxy-register-in-foreman true \
--foreman-proxy-foreman-base-url https://satellite-prod.example.com
9ï¸âƒ£ VÃ©rifier la Capsule
Copy code
Bash
hammer capsule list
hammer capsule info --name capsule-prod.example.com
Statut attendu :
Copy code

Status: OK
Certificates: valid
ğŸ” Ports HTTPS obligatoires (sÃ©curitÃ©)
Flux
Port
Satellite Web UI
443
Capsule â‡„ Satellite
443
Clients â‡„ Capsule
443
Pulp
24816
ğŸŸ¡ Erreurs frÃ©quentes (Ã  Ã©viter)
âŒ Certificat sans SAN
âŒ CN â‰  hostname
âŒ Certificat Capsule signÃ© par CA externe
âŒ Modification manuelle Apache sans satellite-installer
âŒ Firewall bloquant 443 inter-sites
âœ… RÃ©sumÃ© Architecture SSL PRO
Composant
Certificat
Satellite Web UI
CA entreprise
Capsules
CA Satellite
Clients RHEL
CA Satellite
Support Red Hat
100% OK
ğŸ‘‰ Si tu veux
Je peux te fournir :
âœ”ï¸ Checklist sÃ©curitÃ© audit (banque / ISO / CIS)
âœ”ï¸ Script automatisÃ© Ansible SSL Satellite + Capsules
âœ”ï¸ ProcÃ©dure spÃ©ciale environnement DISCONNECTED
âœ”ï¸ Migration SSL sans downtime
Dis-moi ton type dâ€™environnement (Prod / Qualif / Disconnected / Internet) et je tâ€™adapte la procÃ©dure ğŸ‘Œ


Exactement âœ… â€” tu mets le doigt sur la condition CRITIQUE.
Voici la formulation technique juste, + lâ€™explication complÃ¨te que tu peux dire Ã  lâ€™oral ou Ã©crire dans le dossier dâ€™architecture.
âš ï¸ Condition indispensable : capsules en Download Immediate
1ï¸âƒ£ Pourquoi câ€™est une condition bloquante ?
Quand le Satellite tombe :
Les capsules deviennent autonomes
MAIS uniquement si elles ont dÃ©jÃ  localement :
les mÃ©tadonnÃ©es
ET les RPM
ğŸ‘‰ Si les capsules sont en On Demand :
le client demande un RPM
la capsule tente de le rÃ©cupÃ©rer depuis le Satellite
âŒ Satellite indisponible â†’ âŒ Ã©chec du patch
2ï¸âƒ£ Les 3 modes de tÃ©lÃ©chargement (rappel clair)
Impact en cas de panne Satellite
Mode
Comportement
Immediate
Tous les RPM sont tÃ©lÃ©chargÃ©s dÃ¨s la synchro
âœ… Autonomie complÃ¨te
On Demand
RPM tÃ©lÃ©chargÃ©s au 1er client
âŒ DÃ©pend du Satellite
Background
Mix (lazy + prÃ©fetch)
âš ï¸ Autonomie partielle
ğŸ“Œ Conclusion claire
ğŸ‘‰ Immediate est le SEUL mode qui garantit la continuitÃ© du patching en cas dâ€™incident majeur Satellite.
3ï¸âƒ£ Ce que tu dois Ã©crire noir sur blanc (archi / sÃ©cu)
La continuitÃ© de service en cas dâ€™indisponibilitÃ© du Satellite central est assurÃ©e Ã  condition que les capsules soient configurÃ©es en mode â€œDownload Immediateâ€ pour lâ€™ensemble des Content Views publiÃ©es. Dans ce cas, les capsules disposent localement de lâ€™intÃ©gralitÃ© des paquets et mÃ©tadonnÃ©es nÃ©cessaires Ã  lâ€™application des patchs.
4ï¸âƒ£ Pourquoi â€œles deux capsulesâ€ est essentiel
2 capsules = redondance
Mais redondance â‰  rÃ©silience si :
une seule capsule a le contenu
ou si les deux sont en On Demand
ğŸ‘‰ Il faut :
Capsule A : Immediate
Capsule B : Immediate
Synchronisation OK sur les deux
Tests de consommation depuis les deux
5ï¸âƒ£ Ce qui doit Ãªtre vÃ©rifiÃ© AVANT chaque vague de patch
Checklist simple (mais trÃ¨s pro) :
[ ] Content View publiÃ©e
[ ] Promue vers lâ€™environnement cible
[ ] Synchronisation terminÃ©e sur toutes les capsules
[ ] Mode capsule = Immediate
[ ] Test dnf repolist + dnf install depuis un serveur pilote
[ ] Monitoring espace disque capsule OK
6ï¸âƒ£ Point capacitÃ© (important Ã  mentionner)
Immediate = consommation disque Ã©levÃ©e :
OS + patchs cumulÃ©s
Plusieurs versions de CV
Kernel + debug + deps
ğŸ‘‰ Ã€ Ã©crire :
Le mode Immediate implique un dimensionnement disque adaptÃ© sur les capsules afin dâ€™Ã©viter toute saturation.
7ï¸âƒ£ Phrase â€œarchi validableâ€ (clÃ© en comitÃ©)
En cas dâ€™incident majeur sur le Satellite, la continuitÃ© du patching est assurÃ©e uniquement si les capsules sont configurÃ©es en mode Download Immediate et disposent localement de lâ€™ensemble des paquets nÃ©cessaires. Ce point est une condition structurante de lâ€™architecture.
8ï¸âƒ£ Si tu veux, je peux aussi te donner
ğŸ”¹ une phrase courte pour mail de validation
ğŸ”¹ un schÃ©ma avec flux Satellite DOWN / Capsules UP
ğŸ”¹ une commande de contrÃ´le exact cÃ´tÃ© Satellite/Capsule
ğŸ”¹ une reco de sizing disque capsules
Dis-moi ce que tu veux livrer ensuite ğŸ’ª