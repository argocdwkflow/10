Parfait ğŸ‘
Dans yum / dnf, câ€™est autorisÃ© dâ€™avoir plusieurs URLs sur la mÃªme ligne baseurl=, sÃ©parÃ©es par des espaces.
Le client utilisera la premiÃ¨re dispo (failover).
ğŸ‘‰ Donc on peut garder un seul repo avec plusieurs URLs sur la mÃªme ligne.
1ï¸âƒ£ defaults/main.yml
ğŸ‘‰ bp2itools_repo_baseurl devient une liste
Copy code
Yaml
---
bp2itools_repo_path: "/etc/yum.repos.d/bp2itools.repo"

bp2itools_repo_id: "bp2itools"
bp2itools_repo_name: "BP2I Tools Repository"

# âœ… Plusieurs URLs (failover)
bp2itools_repo_baseurls:
  - "http://repo1.server/bp2itools/$releasever/os/$basearch/"
  - "http://repo2.server/bp2itools/$releasever/os/$basearch/"

bp2itools_repo_enabled: 1
bp2itools_repo_gpgcheck: 0
bp2itools_repo_gpgkey: ""

bp2itools_repo_sslverify: true
bp2itools_repo_proxy: ""
bp2itools_repo_exclude: ""
bp2itools_repo_priority: ""

bp2itools_repo_owner: "root"
bp2itools_repo_group: "root"
bp2itools_repo_mode: "0644"
2ï¸âƒ£ templates/bp2itools.repo.j2
ğŸ‘‰ GÃ©nÃ¨re une seule ligne baseurl= avec plusieurs URLs
Copy code
Ini
[{{ bp2itools_repo_id }}]
name={{ bp2itools_repo_name }}
baseurl={{ bp2itools_repo_baseurls | join(' ') }}
enabled={{ bp2itools_repo_enabled }}
gpgcheck={{ bp2itools_repo_gpgcheck }}

{% if bp2itools_repo_gpgcheck | int == 1 and (bp2itools_repo_gpgkey | trim) != '' -%}
gpgkey={{ bp2itools_repo_gpgkey }}
{% endif -%}

{% if (bp2itools_repo_exclude | trim) != '' -%}
exclude={{ bp2itools_repo_exclude }}
{% endif -%}

{% if (bp2itools_repo_priority | string | trim) != '' -%}
priority={{ bp2itools_repo_priority }}
{% endif -%}

{% if (bp2itools_repo_proxy | trim) != '' -%}
proxy={{ bp2itools_repo_proxy }}
{% endif -%}

sslverify={{ 1 if bp2itools_repo_sslverify | bool else 0 }}
3ï¸âƒ£ RÃ©sultat gÃ©nÃ©rÃ© sur le serveur
Copy code
Ini
[bp2itools]
name=BP2I Tools Repository
baseurl=http://repo1.server/bp2itools/9/os/x86_64/ http://repo2.server/bp2itools/9/os/x86_64/
enabled=1
gpgcheck=0
sslverify=1
âœ”ï¸ Failover automatique
âœ”ï¸ Compatible RHEL 7 / 8 / 9
âœ”ï¸ Simple et propre
âš ï¸ Bonnes pratiques (prod)
URLs dans le mÃªme DC ou avec latence similaire
Pas plus de 3 URLs sur une ligne
PrÃ©fÃ©rer un VIP / reverse proxy si possible (F5, HAProxy, Satellite Capsule, etc.)
Si tu veux, je peux te fournir :
une validation Ansible qui vÃ©rifie que toutes les URLs rÃ©pondent (HTTP 200),
un fallback automatique qui dÃ©sactive le repo si toutes les URLs sont KO,
ou une intÃ©gration Satellite / ACS / Capsule adaptÃ©e Ã  ton infra 2I.