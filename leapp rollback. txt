Parfait â€” on va entrer dans le dur technique, Ã©tape par Ã©tape, sans bullshit, et uniquement pour le SEUL cas oÃ¹ câ€™est possible :
âš ï¸ Cette procÃ©dure est VALIDE UNIQUEMENT si le serveur Nâ€™A PAS rebootÃ© sur un kernel RHEL8.
(uname -r doit encore montrer un kernel 3.10.x RHEL7)
ğŸŸ¢ CONTEXTE TECHNIQUE DU ROLLBACK LEAPP (AVANT REBOOT)
Ce que fait rÃ©ellement leapp upgrade
Leapp fonctionne en 3 phases :
Analyse
â†’ collecte des facts, inhibitors, rapports
PrÃ©paration (transactions DNF)
â†’ prÃ©pare un userspace RHEL8 isolÃ©
â†’ planifie une transaction RPM (mais ne lâ€™applique pas au systÃ¨me courant)
Pivot au reboot
â†’ bascule vers initramfs RHEL8
â†’ applique la transaction
â†’ point de non-retour
ğŸ‘‰ Avant reboot : rien dâ€™irrÃ©versible nâ€™est appliquÃ© au systÃ¨me RHEL7 actif.
ğŸ” PRÃ‰-REQUIS OBLIGATOIRES
Copy code
Bash
uname -r
# Doit Ãªtre 3.10.x

cat /etc/redhat-release
# Doit Ãªtre RHEL 7
VÃ©rifier que leapp nâ€™a PAS pivotÃ© :
Copy code
Bash
ls /boot | grep el8
# OK s'il existe mais PAS utilisÃ©

grubby --default-kernel
ğŸ” PROCÃ‰DURE ROLLBACK TECHNIQUE DÃ‰TAILLÃ‰E
1ï¸âƒ£ ArrÃªter proprement le processus Leapp
ğŸ”¹ VÃ©rifier Ã©tat Leapp
Copy code
Bash
leapp upgrade --resume
ğŸ‘‰ Permet de :
reprendre un workflow bloquÃ©
nettoyer les locks
garantir un Ã©tat cohÃ©rent
ğŸ”¹ Stopper dÃ©finitivement leapp
Copy code
Bash
leapp upgrade --stop
ğŸ§  Ce que Ã§a fait techniquement :
annule le workflow actors
supprime les Ã©tats transitoires
libÃ¨re les verrous DNF
2ï¸âƒ£ Supprimer les paquets leapp (sans casser RHEL7)
Copy code
Bash
dnf remove leapp leapp-repository leapp-upgrade-el7toel8 -y
ğŸ“Œ Pourquoi pas dangereux :
leapp nâ€™est pas un composant OS
aucun package critique RHEL7 nâ€™en dÃ©pend
suppression nâ€™affecte pas glibc, systemd, kernel
3ï¸âƒ£ Nettoyage des mÃ©tadonnÃ©es leapp
Copy code
Bash
rm -rf /var/lib/leapp
rm -rf /var/log/leapp
rm -rf /etc/leapp
ğŸ“‚ Contenu supprimÃ© :
Ã©tats actors
journaux
cache de userspace EL8
rapports JSON
4ï¸âƒ£ Rollback DNF (TRÃˆS IMPORTANT)
ğŸ” Identifier la transaction leapp
Copy code
Bash
dnf history
Tu verras :
Copy code

ID | Command line
42 | leapp upgrade
ğŸ” Annuler la transaction
Copy code
Bash
dnf history undo 42
ğŸ§  Ce que DNF fait rÃ©ellement :
annule les packages prÃ©parÃ©s
restaure versions RHEL7
nettoie les dÃ©pendances temporaires
âš ï¸ Si la transaction nâ€™a PAS Ã©tÃ© appliquÃ©e :
la commande est safe
aucun impact systÃ¨me
5ï¸âƒ£ Nettoyage complÃ©mentaire post-leapp
Copy code
Bash
dnf clean all
rm -rf /var/cache/dnf
6ï¸âƒ£ VÃ©rifications post-rollback
ğŸ” VÃ©rifier OS
Copy code
Bash
cat /etc/redhat-release
uname -r
ğŸ” VÃ©rifier packages
Copy code
Bash
rpm -qa | grep leapp
# Doit Ãªtre vide
ğŸ” VÃ©rifier GRUB
Copy code
Bash
grubby --info=ALL | grep el8
# OK si prÃ©sent mais non utilisÃ©
7ï¸âƒ£ VÃ©rifier services critiques
Copy code
Bash
systemctl status network
systemctl status <db>
systemctl status <app>
âŒ CE QUI NE DOIT PAS ÃŠTRE FAIT
Action
Pourquoi
dnf downgrade *
casse glibc
rpm -Uvh --force
corruption RPMDB
Modifier /usr/lib64
suicide OS
Reboot aprÃ¨s pivot
point de non-retour
ğŸ§  LIMITES TECHNIQUES
Ã‰lÃ©ment
Impact
SELinux
Aucun
DB
Aucun
DonnÃ©es
Aucune perte
Kernel
InchangÃ©
Bootloader
InchangÃ©
ğŸ“Œ RÃ‰SUMÃ‰ ULTRA-CLAIR
âœ… Rollback possible UNIQUEMENT avant reboot
âœ… Aucun impact donnÃ©es
âŒ Impossible aprÃ¨s boot kernel RHEL8
ğŸ”¥ Recommandation N3 / PROD
ğŸ‘‰ Si uname -r â‰  3.10 â†’ STOP rollback
ğŸ‘‰ Continuer RHEL8 ou rÃ©installer
Si tu veux, je peux :
Te donner un script rollback automatisÃ©
Analyser un leapp-report.txt
Te fournir une checklist PRE-leapp PROD Satellite
Dis-moi : 1ï¸âƒ£ uname -r
2ï¸âƒ£ cat /etc/redhat-release